<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Class Description Phone</title>
    <style>
        body{
            background: #b1a99d;
        }
        button {
            width: 60px;
            background-color: #fdfdfd;
        }
    </style>
</head>
<body>
<table>
    <tr>
        <td colspan="3"><textarea id="output1" style=" width: 295px; height: 300px"></textarea></td>
        <td style="width: 100px"></td>
        <td colspan="3"><textarea id="output2" style=" width: 295px; height: 300px"></textarea></td>
    </tr>
    <tr>
        <td colspan="2"><input onkeydown="phone1.typing(this.id)" type="text" id="input1"></td>
        <td>
            <button id="send1" value="input1" onclick="phone1.sendMessage(this.value,phone2)">Send</button>
        </td>
        <td colspan="1"></td>
        <td colspan="2"><input onkeydown="phone2.typing(this.id)" type="text" id="input2"></td>
        <td>
            <button id="send2" value="input2" onclick="phone2.sendMessage(this.value,phone1)">Send</button>
        </td>
    </tr>
    <tr>
        <td><input id="battery1"></td>
        <td style="float: right">
            <button id="inbox1" onclick="phone1.showMessageInbox()">Inbox</button>
        </td>
        <td>
            <button id="sent1" onclick="phone1.showMessageSent()">Sent</button>
        </td>
        <td></td>
        <td><input id="battery2"></td>
        <td style="float: right">
            <button id="inbox2" onclick="phone2.showMessageInbox()">Inbox</button>
        </td>
        <td>
            <button id="sent2" onclick="phone2.showMessageSent()">Sent</button>
        </td>
    </tr>
    <tr>
        <td>
            <input id="name1" style="text-align: center ;border-radius: 30px" type="text" value="PHONE 1">
        </td>
        <td>
            <button id="charge1" style="background-color: #1d00e2; color: #e0e0e0" onclick="chargePhone(phone1)">Chagre</button>
        </td>

        <td>
            <input id="switch1" value="ON" onclick="phone1.switchOn()" style=" text-align: center;width: 50px;border-radius: 20px; background-color: #169c00; color: #e0e0e0">
        </td>
        <td></td>
        <td>
            <input id="name2" style=" text-align: center;border-radius: 30px" type="text" value="PHONE 2">
        </td>
        <td>
            <button id="charge2" style="background-color: #1d00e2; color: #e0e0e0" onclick="chargePhone(phone2)">Chagre</button>
        </td>
        <td>
            <input id="switch2" value="ON" onclick="phone2.switchOn()" style=" text-align: center;width: 50px;border-radius: 20px; background-color: #169c00; color: #e0e0e0">
        </td>
    </tr>
</table>
<script>
    let battery = 0;

    class Phone {
        constructor(status, battery, id) {
            this.id = id;
            this.battery = battery;
            this.messageTyping = [];
            this.messageInbox = [];
            this.messageSent = [];
            this.status = status;
        }

        getStatus() {
            return this.status;
        }

        setStatus(status) {
            this.status = status;
        }
        onStart(){
            if (this.status === false){
                document.getElementById("output" + this.id).style.backgroundColor = "#868786"
                document.getElementById("name" + this.id).style.backgroundColor = "#868786"
                document.getElementById("input" + this.id).style.backgroundColor = "#868786"
                document.getElementById("send" + this.id).style.backgroundColor = "#868786"
                document.getElementById("sent" + this.id).style.backgroundColor = "#868786"
                document.getElementById("inbox" + this.id).style.backgroundColor = "#868786"
                document.getElementById("battery" + this.id).style.backgroundColor = "#868786"
                document.getElementById("switch" + this.id).value = "ON";
                document.getElementById("switch" + this.id).style.backgroundColor = "#169c00"
            } else {
                document.getElementById("input" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("name" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("send" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("sent" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("inbox" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("battery" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("output" + this.id).style.backgroundColor = "#ffffff"
                document.getElementById("switch" + this.id).value = "OFF";
                document.getElementById("switch" + this.id).style.backgroundColor = "#fd0000"
            }
        }
        turnOn(){
            if (this.getBattery() > 0){
                document.getElementById("input" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("name" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("send" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("sent" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("inbox" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("battery" + this.id).style.backgroundColor = "#fafafa"
                document.getElementById("output" + this.id).style.backgroundColor = "#ffffff"
                document.getElementById("switch" + this.id).value = "OFF";
                document.getElementById("switch" + this.id).style.backgroundColor = "#fd0000"
                this.status = true;
                alert("Turn on PHONE: " + this.id + "!");
            } else {
                alert("Điện thoại đã hết pin!");
            }
        }
        turnOff(){
            document.getElementById("output" + this.id).style.backgroundColor = "#868786"
            document.getElementById("name" + this.id).style.backgroundColor = "#868786"
            document.getElementById("input" + this.id).style.backgroundColor = "#868786"
            document.getElementById("send" + this.id).style.backgroundColor = "#868786"
            document.getElementById("sent" + this.id).style.backgroundColor = "#868786"
            document.getElementById("inbox" + this.id).style.backgroundColor = "#868786"
            document.getElementById("battery" + this.id).style.backgroundColor = "#868786"
            document.getElementById("switch" + this.id).value = "ON";
            document.getElementById("switch" + this.id).style.backgroundColor = "#169c00"
            this.status = false;
            alert("Turn off PHONE: " + this.id + "!");
        }
        switchOn() {
            if (this.status === false) {
               this.turnOn();
            } else {
               this.turnOff();
            }
        }
        decreaseBattery() {
            battery = this.getBattery();
            console.log(battery)
            if (battery > 0) {
                let battery = --this.battery + "%";
                document.getElementById("battery" + this.id).value = battery;
            } else {
                document.getElementById("battery" + this.id).value = "hết pin tắt nguồn";
               this.turnOff();
            }
        }

        getBattery() {
            return this.battery;
        }

        setBattery(battery) {
            this.battery = battery;
        }

        typing(id) {
            if (this.getStatus() === true) {
                this.decreaseBattery();
                let a = document.getElementById(id).value;
                this.messageTyping.push(a);
            } else {
                document.getElementById(id).value = "";
                alert("Điện thoại đang tắt!");
            }
        }

        sendMessage(idInput, phone) {
            if (this.getStatus() === true) {
                this.decreaseBattery();
                let mess = document.getElementById(idInput).value;
                document.getElementById(idInput).value = "";
                document.getElementById("output" + phone.id).value = "";
                this.messageSent.push(mess);
                phone.setMessageInbox(mess);
                document.getElementById("output" + phone.id).value = phone.getMessInbox();
            } else {
                alert("Điện thoại đang tắt!");
            }
        }

        setMessageInbox(messageInbox) {
            this.messageInbox.push(messageInbox);
        }

        getMessInbox() {
            this.decreaseBattery();
            return this.messageInbox[this.messageInbox.length - 1];
        }

        showMessageInbox() {
            if (this.getStatus() === true) {
                document.getElementById("output" + this.id).value = ""
                this.decreaseBattery();
                console.log(this.messageInbox);
                document.getElementById("output" + this.id).value = this.messageInbox;
            } else {
                alert("Điện thoại đang tắt!");
            }

        }

        showMessageSent() {
            if (this.getStatus() === true) {
                document.getElementById("output" + this.id).value = "";
                this.decreaseBattery();
                document.getElementById("output" + this.id).value = this.messageSent;
            } else {
                alert("Điện thoại đang tắt!");
            }

        }
    }

    let phone1 = new Phone(false, 2, 1);
    let phone2 = new Phone(true, 100, 2);
    let phone11;
    let phone22;
    let repeatCharge1;
    let repeatCharge2;
    function chargePhone(phone) {

        if (phone.id === 1){
            phone11 = phone;
            repeatCharge1 = setInterval(chargeBattery1, 300);
        } else {
            phone22 = phone;
            repeatCharge2 = setInterval(chargeBattery2, 300);
        }
    }

    function chargeBattery1() {
        if (phone11.battery < 100) {
            startColor1();
            let batter1 = ++phone11.battery;
            document.getElementById("battery" + phone11.id).value = batter1 + "%";
        } else {
            stopChargePhone()
            stopColor1();
        }
    }
    function chargeBattery2() {
        if (phone22.battery < 100) {
            startColor2();
            let batter2 = ++phone22.battery;
            document.getElementById("battery" + phone22.id).value = batter2 + "%";
        } else {
            stopChargePhone()
            stopColor2();
        }
    }
    function stopChargePhone(){
        if (this.id === 1){
            clearInterval(repeatCharge1);
        } else{
            clearInterval(repeatCharge2);
        }
    }
    let repeatColor1;
    let onColor1 = false;
    let battery1;
    let repeatColor2;
    let onColor2 = false;
    let battery2;
    function color1() {
        battery1 = document.getElementById("battery" + phone11.id);
        battery1.style.backgroundColor = battery1.style.backgroundColor == "lightblue" ? "#b6f8a7" : "lightblue";
    }
    function startColor1() {
        if (onColor1 === false) {
            onColor1 = true;
            repeatColor1 = setInterval(color1, 500);
        }
    }
    function stopColor1() {
        battery1.style.backgroundColor = "#ffffff";
        onColor1 = false;
        clearInterval(repeatColor1);
    }
    function color2() {
        battery2 = document.getElementById("battery" + phone22.id);
        battery2.style.backgroundColor = battery2.style.backgroundColor == "lightblue" ? "#b6f8a7" : "lightblue";
    }
    function startColor2() {
        if (onColor2 === false) {
            onColor2 = true;
            repeatColor2 = setInterval(color2, 500);
        }
    }
    function stopColor2() {
        battery2.style.backgroundColor = "#ffffff";
        onColor2 = false;
        clearInterval(repeatColor2);
    }
    phone1.onStart();
    phone2.onStart();
</script>
</body>
</html>